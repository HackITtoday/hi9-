<link rel="import" href="../bower_components/user-badges/user-badges.html">
<link rel="import" href="../bower_components/user-surveys/user-surveys.html">

<dom-module id="user-info">
  <template>
    <h2>{{name}}</h2>
    <user-badges edit location="https://hi9site.firebaseio.com/users/" folder="{{folder}}"></user-badges>
    <user-surveys answered folder="{{folder}}" location="https://hi9site.firebaseio.com/users/"></user-surveys>
    <div>
      first used {{firstUsed}}
      time on chrome {{timeUsed}}
      last Used {{lastUsed}}
      <template is="dom-repeat" items="{{listVisits}}">
        site {{item.sites}} time {{item.time}}
      </template>
    </div>

  </template>
</dom-module>
<script>
  Polymer({
    is: "user-info",
    properties: {
      name: {computed:"getName(user, paramsUid)"},
      folder: {computed:"getFolder(userUid, paramsUid)"},
      firstUsed: {computed:"getFirstUsed(user, paramsUid)"},
      timeUsed: {computed:"getTimeUsed(user, paramsUid)"},
      lastUsed: {computed:"getLastUsed(user, paramsUid)"},
      listVisits: {computed:"getListVisits(user, paramsUid)"}
    },
    getFolder: function(userUid, paramsUid) {
      return paramsUid
      // todo return userUid + "/users/" + paramsUid
    },
    getName: function(user, paramsUid) {
      if (user != null) {
        return user.users[paramsUid].user.google.displayName
      }
    },
    getFirstUsed: function(user, paramsUid) {
      if (user != null) {
        return first(user.users[paramsUid].log)
      }
    },
    getLastUsed: function(user, paramsUid) {
      if (user != null) {
        return last(user.users[paramsUid].log)
      }
    },
    getTimeUsed: function(user, paramsUid) {
      if (user != null) {
        return timeUsed(user.users[paramsUid].log)
      }
    },
    getListVisits: function(user, paramsUid) {
      if (user != null) {
        return sitesLogged(user.users[paramsUid].log)
      }
    }
  });
  function last(log) {
    var last = 0
    for(var index in log) { 
      if (log.hasOwnProperty(index)) {
        log[index]
        if (log[index].time) {
          if (last < (+log[index].time)) {
            last = (+log[index].time)
          }
        } else if (log[index].end) {
          if (last < (+log[index].end)) {
            last = (+log[index].end)
          }
        } else if (log[index].first) {
          if (last < (+log[index].first)) {
            last = (+log[index].first)
          }
        }
      }
    }
    return last
  }
  function first(log) {
    return 2
  }
  function timeUsed(log) {
    return 3 
  }
  function sitesLogged(log) {
    return 4
  }
</script>
